{% extends "base.html" %}

{% block title %}Text Analysis - MBTI Personality Predictor{% endblock %}

{% block extra_css %}
<style>
    .text-intro {
        margin-bottom: 20px;
        color: #555;
        font-family: var(--font-body);
    }
    .text-intro-label {
        display: block;
        margin-bottom: 10px;
        font-weight: 600;
        color: #111642;
        font-family: var(--font-body);
    }
    .text-input-area {
        width: 100%;
        padding: 15px;
        border: 2px solid #c3caf5;
        border-radius: 10px;
        font-size: 15px;
        font-family: var(--font-body);
        resize: vertical;
        background: #050611;
        color: #e5ebff;
        box-shadow: 0 0 12px rgba(79, 243, 255, 0.18) inset;
    }
    .text-input-area::placeholder {
        color: #7a81b5;
    }
    .text-tip {
        margin-top: 5px;
        color: #7a81b5;
        font-size: 0.8em;
        font-family: var(--font-body);
    }
    .text-result-card {
        background: radial-gradient(circle at top left, #ffffff 0, #eef0ff 40%, #d3dbff 100%);
        color: #111642;
    }
    .text-result-title {
        color: #111642;
        margin-bottom: 20px;
    }
    .text-type-badge {
        font-family: var(--font-primary);
        font-size: 2.6rem;
        letter-spacing: 0.16em;
        text-transform: uppercase;
        margin-bottom: 10px;
        text-shadow: 0 0 8px rgba(79, 243, 255, 0.45);
    }
    .text-type-sub {
        font-size: 0.95rem;
        opacity: 0.9;
        font-family: var(--font-body);
    }
    .dimension-chip {
        background: rgba(255, 255, 255, 0.12);
        border-radius: 10px;
        padding: 20px;
        text-align: center;
    }
    .dimension-chip-label {
        font-size: 0.9rem;
        margin-bottom: 5px;
        font-family: var(--font-primary);
        letter-spacing: 0.08em;
        text-transform: uppercase;
    }
    .dimension-chip-letter {
        font-size: 1.8rem;
        margin-bottom: 4px;
    }
    .dimension-chip-conf {
        font-size: 0.85rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="card">
    <h2>üìù Text-Based Personality Prediction</h2>
    <p class="text-intro">
        Enter a text description about yourself, your preferences, or how you approach situations. 
        Our machine learning models will analyze your writing style to predict your MBTI personality type.
    </p>
    
    {% if error %}
    <div class="alert alert-error">
        <strong>Error:</strong> {{ error }}
    </div>
    {% endif %}
    
    <form method="POST" action="{{ url_for('text_prediction') }}">
        <div style="margin-bottom: 20px;">
            <label for="text_input" class="text-intro-label">
                Your Text Description:
            </label>
            <textarea 
                id="text_input" 
                name="text_input" 
                rows="8" 
                class="text-input-area"
                placeholder="Example: I enjoy breaking down complex problems and finding logical solutions. I prefer working independently and value deep, meaningful conversations over small talk..."
                required>{{ input_text if input_text else '' }}</textarea>
            <p class="text-tip">
                üí° Tip: Write at least 50-100 words for better accuracy.
            </p>
        </div>
        
        <button type="submit" class="btn">üîÆ Predict Personality</button>
    </form>
</div>

{% if result %}
<div class="card text-result-card">
    <h2 class="text-result-title">üéØ Prediction Results</h2>
    
    <div style="text-align: center; padding: 30px; background: rgba(255,255,255,0.1); border-radius: 10px; margin-bottom: 30px;">
        <div class="text-type-badge">{{ result.personality_type }}</div>
        {% if mbti_info %}
        <div class="text-type-sub">{{ mbti_info.title }} ¬∑ {{ result.description }}</div>
        {% else %}
        <div class="text-type-sub">{{ result.description }}</div>
        {% endif %}
    </div>
    
    <h3 style="margin-bottom: 15px; font-family: var(--font-primary); letter-spacing: 0.08em; text-transform: uppercase; font-size: 0.9rem;">
        üìä Dimension Analysis
    </h3>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
        {% for dimension, pred in result.dimensions.items() %}
        {% if dimension == 'E/I' %}
            {% set letter = 'I' if pred.prediction == 1 else 'E' %}
        {% elif dimension == 'S/N' %}
            {% set letter = 'S' if pred.prediction == 0 else 'N' %}
        {% elif dimension == 'T/F' %}
            {% set letter = 'T' if pred.prediction == 0 else 'F' %}
        {% elif dimension == 'J/P' %}
            {% set letter = 'J' if pred.prediction == 1 else 'P' %}
        {% else %}
            {% set letter = 'X' %}
        {% endif %}
        
        <div class="dimension-chip">
            <div class="dimension-chip-label">{{ dimension }}</div>
            <div class="dimension-chip-letter">{{ letter }}</div>
            <div class="dimension-chip-conf">{{ "%.1f"|format(pred.probability * 100) }}% confidence</div>
        </div>
        {% endfor %}
    </div>
</div>

{% if mbti_info %}
<div class="card">
    <h2>üìñ Detailed Personality Description</h2>
    
    <div style="margin-bottom: 25px;">
        <h3 style="color: #667eea; margin-bottom: 15px; font-size: 1.2em;">
            {{ result.personality_type }} ‚Äì {{ mbti_info.title }}
        </h3>
        <p style="color: #555; line-height: 1.8; font-size: 1.05em; margin-bottom: 25px;">
            {{ mbti_info.summary }}
        </p>
        
        {% if mbti_info.behaviors and mbti_info.behaviors|length > 0 %}
        <h3 style="color: #667eea; margin-bottom: 15px; font-size: 1.1em;">Key Behaviors & Characteristics</h3>
        <div style="display: grid; gap: 20px;">
            {% for behavior in mbti_info.behaviors %}
            <div style="padding: 20px; background: #f8f9fa; border-radius: 10px; border-left: 4px solid #667eea;">
                <h4 style="color: #667eea; margin-bottom: 10px; font-size: 1.05em; font-weight: 600;">
                    {{ behavior.title }}
                </h4>
                <p style="color: #555; line-height: 1.7; margin: 0;">
                    {{ behavior.description }}
                </p>
            </div>
            {% endfor %}
        </div>
        {% endif %}
    </div>
</div>
{% endif %}
{% endif %}
{% endblock %}
